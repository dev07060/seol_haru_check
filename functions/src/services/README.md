# VertexAI Prompt Engineering System

이 문서는 주간 AI 분석을 위한 VertexAI 프롬프트 엔지니어링 시스템에 대해 설명합니다.

## 개요

`VertexAIPromptService`는 사용자의 운동과 식단 인증 데이터를 분석하기 위한 한국어 프롬프트를 생성하는 서비스입니다. 다양한 시나리오에 맞는 전문적인 프롬프트를 제공하며, 데이터가 부족한 경우를 위한 대체 프롬프트도 포함합니다.

## 주요 기능

### 1. 종합 분석 프롬프트 (`generateAnalysisPrompt`)
- 충분한 데이터가 있는 사용자를 위한 포괄적인 분석 프롬프트
- 운동 분석, 식단 분석, 종합 평가, 강점, 개선점, 추천사항 포함
- 한국인의 생활 패턴과 식문화를 고려한 맞춤형 분석

### 2. 운동 전문 분석 프롬프트 (`generateExerciseAnalysisPrompt`)
- 운동 데이터에 특화된 전문적인 분석 프롬프트
- 운동 빈도, 일관성, 다양성, 균형 등을 중점적으로 분석
- 부상 예방과 효과 극대화를 위한 전문적 조언

### 3. 식단 전문 분석 프롬프트 (`generateDietAnalysisPrompt`)
- 식단 데이터에 특화된 영양학적 분석 프롬프트
- 영양 균형, 식사 패턴, 식품 다양성 등을 중점적으로 분석
- 한국 전통 식단과 현대적 영양학을 결합한 조언

### 4. 추천사항 생성 프롬프트 (`generateRecommendationPrompt`)
- 다음 주를 위한 구체적이고 실행 가능한 추천사항 생성
- 운동, 식단, 생활 습관 카테고리별 균형잡힌 조언
- 단계적 발전이 가능한 현실적인 목표 제시

### 5. 데이터 부족 시 격려 프롬프트 (`generateInsufficientDataPrompt`)
- 최소 요구사항을 충족하지 못한 사용자를 위한 격려 메시지
- 비판적이지 않고 동기부여가 되는 톤으로 작성
- 작은 시작의 가치와 꾸준함의 중요성 강조

### 6. 무활동 시 동기부여 프롬프트 (`generateNoDataMotivationalPrompt`)
- 전혀 활동하지 않은 사용자를 위한 따뜻한 격려 메시지
- 새로운 시작에 대한 희망적 메시지
- 부담스럽지 않은 수준의 간단한 실천 방안 제시

## 프롬프트 설계 원칙

### 1. 한국어 최적화
- 자연스러운 한국어 표현 사용
- 한국인의 정서와 문화적 맥락 고려
- 존댓말과 격려적인 톤 유지

### 2. 개인화된 접근
- 사용자의 닉네임과 구체적인 데이터 활용
- 개인의 패턴과 특성을 반영한 맞춤형 분석
- 일관성 점수와 통계를 활용한 객관적 평가

### 3. 실행 가능성
- 구체적이고 측정 가능한 조언 제공
- 사용자의 현재 수준에서 실현 가능한 목표
- 단계적 발전이 가능한 점진적 접근

### 4. 긍정적 동기부여
- 격려적이고 지지적인 메시지 전달
- 작은 성취도 인정하고 칭찬
- 실패보다는 개선과 발전에 초점

### 5. 전문성과 신뢰성
- 운동과 영양학적 근거에 기반한 조언
- 안전성을 고려한 권장사항
- 과학적이면서도 이해하기 쉬운 설명

## 데이터 처리 및 보안

### 1. 데이터 정제
- 개인정보 보호를 위한 민감 정보 제거
- 전화번호, 이메일, 주민등록번호 등 자동 마스킹
- 적절한 길이로 내용 제한 (최대 500자)

### 2. 프롬프트 길이 관리
- 최대 8,000자로 프롬프트 길이 제한
- 초과 시 자동 절단 및 안내 메시지 추가
- 구조적 정보 보존을 위한 스마트 절단

### 3. 오류 처리
- AI 응답 파싱 실패 시 기본 메시지 제공
- 예외 상황에 대한 우아한 처리
- 로깅을 통한 문제 추적 및 개선

## 사용 예시

```typescript
import { vertexAIPromptService } from './vertexAIPromptService';

// 종합 분석 프롬프트 생성
const analysisPrompt = vertexAIPromptService.generateAnalysisPrompt(userData);

// 운동 전문 분석 프롬프트 생성
const exercisePrompt = vertexAIPromptService.generateExerciseAnalysisPrompt(userData);

// AI 응답 파싱
const parsedResult = vertexAIPromptService.parseAnalysisResponse(aiResponse);

// VertexAI 설정 가져오기
const config = vertexAIPromptService.getGenerationConfig();
```

## 테스트

포괄적인 단위 테스트가 포함되어 있습니다:

```bash
npm test -- --testPathPattern=vertexAIPromptService.test.ts
```

테스트 커버리지:
- 모든 프롬프트 생성 메서드
- 다양한 데이터 시나리오 (충분한 데이터, 부족한 데이터, 데이터 없음)
- 응답 파싱 및 오류 처리
- 한국어 날짜 형식 및 문화적 요소
- 프롬프트 길이 제한 및 절단 로직

## 확장성

이 시스템은 다음과 같은 확장이 가능합니다:

1. **새로운 분석 유형 추가**: 수면, 스트레스, 체중 관리 등
2. **다국어 지원**: 영어, 일본어 등 다른 언어 프롬프트
3. **개인화 수준 향상**: 사용자 선호도, 목표, 제약사항 반영
4. **AI 모델별 최적화**: 다른 LLM 모델에 맞는 프롬프트 변형
5. **실시간 피드백**: 사용자 반응에 따른 프롬프트 개선

## 성능 고려사항

- 프롬프트 생성은 메모리 효율적으로 설계됨
- 대용량 데이터 처리를 위한 배치 처리 지원
- 캐싱 가능한 구조로 설계 (필요시 Redis 등 활용 가능)
- 비동기 처리를 통한 응답 시간 최적화

## 모니터링 및 로깅

- Firebase Functions 로깅 시스템 활용
- 프롬프트 생성 성공/실패 추적
- 응답 파싱 오류 모니터링
- 성능 메트릭 수집 (프롬프트 길이, 처리 시간 등)